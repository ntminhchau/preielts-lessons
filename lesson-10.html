<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <title>Lesson 10 - Listening</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reset.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/theme/white.min.css" id="theme">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">

    <style>
        :root {
            --r-main-font-size: 28px; /* Tăng cỡ chữ mặc định */
            --r-heading1-size: 2.5em;
            --r-heading2-size: 1.8em;
            --r-heading3-size: 1.5em;
        }
        .reveal .slides section {
            text-align: left;
        }
        .reveal h1, .reveal h2, .reveal h3 {
            text-align: center;
            margin-bottom: 30px;
        }
        .reveal audio {
            width: 100%;
            margin: 15px 0;
        }
        .reveal .exercise-form {
            border: 1px solid #ccc;
            padding: 20px;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .reveal .exercise-form table {
            width: 100%;
            border-collapse: collapse;
        }
        .reveal .exercise-form td {
            padding: 8px;
            border: 1px solid #ddd;
        }
        .reveal .exercise-form td:first-child {
            font-weight: bold;
            width: 30%;
        }

        /* === ANNOTATION STYLES === */
        #annotation-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        body.annotation-active.pen-tool-active { cursor: crosshair; }
        body.annotation-active.highlight-tool-active { cursor: crosshair; }
        body.annotation-active.eraser-tool-active { cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='white' stroke='black'><rect x='4' y='4' width='16' height='16' rx='2'/></svg>") 12 12, auto; }
        body.annotation-active.text-tool-active { cursor: text; }

        .annotation-toolbar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            padding: 8px;
            border-radius: 8px;
            z-index: 101;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .tool-btn {
            background: #fff; color: #333; border: none;
            width: 40px; height: 40px; font-size: 18px;
            cursor: pointer; border-radius: 5px;
            display: flex; align-items: center; justify-content: center;
        }
        .tool-btn.active {
            background: #007bff; color: white;
        }
        .text-input-overlay {
            position: fixed;
            z-index: 102;
            border: 1px dashed #007bff;
            background: rgba(255, 255, 255, 0.9);
            padding: 5px;
            outline: none;
            font-family: sans-serif;
            resize: none;
        }
    </style>
</head>
<body>
    <div class="reveal">
        <div class="slides">
            
            <section>
                <h2>LISTENING: FORM AND NOTE COMPLETION</h2>
                <h4>Quy trình làm bài:</h4>
                <ol>
                    <li>Đọc kỹ hướng dẫn (Vd: Write NO MORE THAN TWO WORDS...).</li>
                    <li>Xác định cần điền TỪ hay SỐ.</li>
                    <li>Xác định loại từ cần điền (danh từ, động từ, tính từ...).</li>
                    <li>Nghe được – điền ngay vào bài.</li>
                    <li>Nghe nhưng chưa chắc – ghi lại dữ kiện nghe được.</li>
                    <li>Kiểm tra lại sau khi làm xong (chính tả, số ít/nhiều, ngữ pháp).</li>
                </ol>
            </section>

            <section>
                <h3>Exercise 1</h3>
                <audio controls src="Assets/lesson-10/audio/lesson-10-ex1.mp3"></audio>
                <p>Complete these notes with information from the flight arrivals board below.</p>
                <ul>
                    <li>Spanish flight arrived at (1) .................</li>
                    <li>Flight CCA1550 from (2) ................. arrived at 6.00</li>
                    <li>Emirati flight no. (3) ................. delayed.</li>
                    <li>Flight from Lison landed at terminal (4) .................</li>
                </ul>
                <hr>
                <h3>Exercise 2</h3>
                <audio controls src="Assets/lesson-10/audio/lesson-10-ex2.mp3"></audio>
                <p>You will hear a conversation between two friends planning a visit. Complete the notes.</p>
                <ul>
                    <li>Sam arrives at: (1) ................. on (2) .................</li>
                    <li>Airline: (3) ................. Flight number: (4) .................</li>
                </ul>
            </section>

            <section>
                <h3>Exercise 3</h3>
                <audio controls src="Assets/lesson-10/audio/lesson-10-ex3.mp3"></audio>
                <p>You will hear a telephone conversation in which Sam is booking a taxi. Complete the form.</p>
                <div class="exercise-form">
                    <table>
                        <tr><td>NAME OF PASSENGER:</td><td>SAM WILLIAMS</td></tr>
                        <tr><td>PICK-UP DATE AND TIME:</td><td>Wed 6th July (1).................</td></tr>
                        <tr><td>PICK-UP POINT:</td><td>(2)................. WILLOWSIDE BANK</td></tr>
                        <tr><td>NO. & STREET:</td><td>(3).................</td></tr>
                        <tr><td>TOWN:</td><td>(4).................</td></tr>
                        <tr><td>POSTCODE:</td><td>(5) 07789 .................</td></tr>
                        <tr><td>DESTINATION:</td><td>HEATHROW - TERMINAL 5</td></tr>
                    </table>
                </div>
            </section>

            <section>
                <h3>Exercise 4</h3>
                <audio controls src="Assets/lesson-10/audio/lesson-10-ex4.mp3"></audio>
                <p>You will hear a conversation between a flight attendant and a passenger completing a landing card. Complete the form.</p>
                 <div class="exercise-form">
                    <table>
                        <tr><td>Family name:</td><td>LIU</td></tr>
                        <tr><td>First name(s):</td><td>(1) .................</td></tr>
                        <tr><td>Date of birth:</td><td>(2) .................</td></tr>
                        <tr><td>Contact address in the UK:</td><td>(3) .................</td></tr>
                    </table>
                </div>
            </section>
            
            <section>
                <h3>Exercise 5</h3>
                <audio controls src="Assets/lesson-10/audio/lesson-10-ex5.mp3"></audio>
                 <p>You will hear a telephone conversation between a hotel receptionist and a caller making a reservation. Complete the form.</p>
                <div class="exercise-form">
                     <table>
                        <tr><td>Type of room:</td><td>(1) Single / Double - twin beds / Double - king-sized bed</td></tr>
                        <tr><td>Name:</td><td>(2) .................</td></tr>
                        <tr><td>Home address:</td><td>(3) ................. Avenue, Cambridge</td></tr>
                         <tr><td>Postcode:</td><td>(4) .................</td></tr>
                         <tr><td>Transport:</td><td>(5) .................</td></tr>
                         <tr><td>Meals:</td><td>(6) .................</td></tr>
                         <tr><td>Date of arrival:</td><td>(7) .................</td></tr>
                    </table>
                </div>
            </section>
            
            <section>
                <h3>Exercise 8</h3>
                 <audio controls src="Assets/lesson-10/audio/lesson-10-ex8.mp3"></audio>
                <p>Listen to a recording of an interview in a survey of shopping habits. Complete the notes.</p>
                <ul>
                    <li>Four people in the family - only two (1) .................</li>
                    <li>Mother buys the food. Makes a (2) ................. first.</li>
                    <li>Goes to (3) ................. weekly.</li>
                    <li>Miriam (4) ................. most. Sometimes buys clothes she doesn't like. Takes them back and asks for (5) .................</li>
                </ul>
            </section>
            
            <section>
                <h3>Exercise 9</h3>
                 <audio controls src="Assets/lesson-10/audio/lesson-10-ex9.mp3"></audio>
                <p>Listen to a talk about shopping habits in different countries. Complete the notes.</p>
                <p><b>Who does the shopping?</b></p>
                <ul>
                    <li>In the UK (1) ................. % food bought by women.</li>
                    <li>In some countries (2) ................. % men do grocery shopping.</li>
                    <li>Habits changing - US (3) ................. % of men shop for food.</li>
                </ul>
                 <p><b>Where do people shop?</b></p>
                 <ul>
                    <li>In cities: (4) ................. and (5) .................</li>
                    <li>In country (6) .................</li>
                </ul>
            </section>

        </div>
    </div>
    
    <canvas id="annotation-canvas"></canvas>
    <div class="annotation-toolbar">
        <button class="tool-btn" id="pen-tool" title="Vẽ (P)"><i class="fa-solid fa-pencil"></i></button>
        <button class="tool-btn" id="highlight-tool" title="Highlight (H)"><i class="fa-solid fa-highlighter"></i></button>
        <button class="tool-btn" id="text-tool" title="Viết chữ (T)"><i class="fa-solid fa-font"></i></button>
        <button class="tool-btn" id="eraser-tool" title="Tẩy (E)"><i class="fa-solid fa-eraser"></i></button>
        <div class="separator" style="width:1px; height:30px; background:#666; margin:0 5px;"></div>
        <input type="color" id="color-picker" title="Chọn màu" value="#FF0000">
        <input type="range" id="size-picker" min="2" max="50" value="5" title="Chọn cỡ bút" style="margin: 0 5px;">
        <div class="separator" style="width:1px; height:30px; background:#666; margin:0 5px;"></div>
        <button class="tool-btn" id="clear-tool" title="Xóa hết"><i class="fa-solid fa-trash"></i></button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.min.js"></script>
    <script>
        Reveal.initialize({ history: false, center: false, slideNumber: true, width: 1280, height: 960 });

        const canvas = document.getElementById('annotation-canvas');
        const ctx = canvas.getContext('2d');
        const toolbar = document.querySelector('.annotation-toolbar');
        
        let currentTool = '';
        let isDrawing = false;
        let strokeColor = '#ff0000';
        let brushSize = 5;
        const savedAnnotations = new Map();

        function resizeCanvas() {
            const scale = Reveal.getScale();
            const revealEl = Reveal.getRevealElement();
            const revealRect = revealEl.getBoundingClientRect();

            canvas.width = revealRect.width;
            canvas.height = revealRect.height;
            canvas.style.top = `${revealRect.top}px`;
            canvas.style.left = `${revealRect.left}px`;
            
            loadAnnotations(Reveal.getIndices());
        }

        Reveal.on('ready', resizeCanvas);
        window.addEventListener('resize', resizeCanvas);
        Reveal.on('resize', resizeCanvas);

        function getCanvasPosition(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return {
                x: clientX - rect.left,
                y: clientY - rect.top,
            };
        }

        function saveAnnotations(indices) {
            if (!indices) return;
            const key = `${indices.h}-${indices.v}`;
            if (!isCanvasBlank(canvas)) {
                savedAnnotations.set(key, canvas.toDataURL());
            } else {
                 savedAnnotations.delete(key);
            }
        }

        function loadAnnotations(indices) {
            if (!indices) return;
            const key = `${indices.h}-${indices.v}`;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (savedAnnotations.has(key)) {
                const img = new Image();
                img.src = savedAnnotations.get(key);
                img.onload = () => ctx.drawImage(img, 0, 0);
            }
        }
        
        function isCanvasBlank(c) {
            return !c.getContext('2d').getImageData(0, 0, c.width, c.height).data.some(channel => channel !== 0);
        }

        Reveal.on('slidechanged', event => {
            saveAnnotations(Reveal.getIndices(event.previousSlide));
            loadAnnotations(Reveal.getIndices(event.currentSlide));
        });

        function start(e) {
            if (currentTool === '' || currentTool === 'text') return;
            e.preventDefault();
            isDrawing = true;
            const pos = getCanvasPosition(e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        }

        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();
            const pos = getCanvasPosition(e);
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            const scale = Reveal.getScale();

            switch (currentTool) {
                case 'pen':
                    ctx.globalCompositeOperation = 'source-over';
                    ctx.strokeStyle = strokeColor;
                    ctx.lineWidth = brushSize / scale;
                    break;
                case 'highlight':
                    ctx.globalCompositeOperation = 'source-over';
                    ctx.strokeStyle = 'rgba(255, 255, 0, 0.4)';
                    ctx.lineWidth = (brushSize * 5) / scale; // Highlighter is thicker
                    break;
                case 'eraser':
                    ctx.globalCompositeOperation = 'destination-out';
                    ctx.lineWidth = (brushSize * 4) / scale; // Eraser is thicker
                    break;
            }
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
        }

        function stop(e) {
            if (!isDrawing) return;
            e.preventDefault();
            isDrawing = false;
        }

        // Text tool logic
        function handleTextToolClick(e) {
            if (currentTool !== 'text') return;
            const pos = getCanvasPosition(e);
            createTextInput(pos, e.clientX, e.clientY);
        }

        function createTextInput(canvasPos, clientX, clientY) {
            const textarea = document.createElement('textarea');
            textarea.className = 'text-input-overlay';
            const scale = Reveal.getScale();
            textarea.style.left = `${clientX}px`;
            textarea.style.top = `${clientY}px`;
            textarea.style.fontSize = `${24 * scale}px`; // Adjust font size with scale
            textarea.style.color = strokeColor;

            document.body.appendChild(textarea);
            textarea.focus();

            const finishText = () => {
                drawText(textarea.value, canvasPos.x, canvasPos.y);
                document.body.removeChild(textarea);
            };

            textarea.addEventListener('blur', finishText);
            textarea.addEventListener('keydown', e => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    finishText();
                }
            });
        }

        function drawText(text, x, y) {
            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = strokeColor;
            const scale = Reveal.getScale();
            const fontSize = 24 * scale;
            ctx.font = `${fontSize}px sans-serif`;
            const lines = text.split('\n');
            lines.forEach((line, index) => {
                ctx.fillText(line, x, y + (index * fontSize * 1.2));
            });
        }

        canvas.addEventListener('mousedown', start, { passive: false });
        canvas.addEventListener('mousemove', draw, { passive: false });
        window.addEventListener('mouseup', stop, { passive: false });
        canvas.addEventListener('click', handleTextToolClick);


        toolbar.addEventListener('click', e => {
            const btn = e.target.closest('.tool-btn');
            if (!btn) return;

            const selectedTool = btn.id.replace('-tool', '');

            if (selectedTool === 'clear') {
                if (confirm('Bạn có chắc muốn xóa hết chú thích trên slide này?')) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                }
                return;
            }

            // Remove active state from body and buttons
            document.body.className = document.body.className.replace(/\S+-tool-active\s?/, '');
            document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));

            if (currentTool === selectedTool) {
                currentTool = '';
                canvas.style.pointerEvents = 'none';
                document.body.classList.remove('annotation-active');
            } else {
                currentTool = selectedTool;
                btn.classList.add('active');
                document.body.classList.add('annotation-active');
                document.body.classList.add(`${currentTool}-tool-active`);
                canvas.style.pointerEvents = 'auto';
            }
        });
        
        document.getElementById('color-picker').addEventListener('input', e => {
            strokeColor = e.target.value;
        });
        document.getElementById('size-picker').addEventListener('input', e => {
            brushSize = e.target.value;
        });

    </script>
</body>
</html>

